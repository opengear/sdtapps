#!/bin/bash

function tarup () {	
	jarfile="$1"
	configfile="$2"
	distfile="$3"

	rm -rf "$tardir" &> /dev/null
	mkdir "$tardir"
	cp "$jarfile" "$tardir"
	cp "$configfile" "$tardir"/defaults.xml
	tar -c "$tardir" > "$distfile".tar
	gzip "$distfile".tar
	rm -rf "$tardir"
}

distdir="`dirname $0`/../dist"
if [[ ! -d  "$distdir" ]] ; then
	echo "Can't find dist directory"
	exit 1
fi
if [[ ! -e "${distdir}/sdtcon.jar" ]] || [[ ! -e "${distdir}/sdtcon-mac.jar" ]] ; then
	echo "Can't find sdtcon JAR files in ${distdir}, have you built them?"
	exit 1
fi
cd "$distdir"

version=`grep VERSION ../src/sdtconnector/SDTConnector.java|sed 's/.*\"\(.*\)\".*/\1/'`
echo "SDTConnector version: $version"

tardir="sdtconnector-${version}"

tarup "sdtcon.jar" "../tools/defaults.xml" "sdtconnector-${version}"
tarup "sdtcon-mac.jar" "../tools/defaults.xml" "sdtconnector-mac-${version}"

if [[ -e "../tools/defaults-prop.xml" ]] ; then
	tarup "sdtcon.jar" "../tools/defaults-prop.xml" "sdtconnector-${version}-prop"
	tarup "sdtcon-mac.jar" "../tools/defaults-prop.xml" "sdtconnector-mac-${version}-prop"
fi

cd - &> /dev/null
